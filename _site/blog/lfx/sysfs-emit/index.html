<!doctype html><html data-enable-theme-switch="true" data-use-system-theme="false" data-default-theme="light" data-current="post" lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Getting Familiar with OrangeFS ‚Äì and Making (and Fixing) Mistakes</title><meta name="description" content="Get to know me through my personal blogs!"><link rel="dns-prefetch" href="https://identity.netlify.com"><script async src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="stylesheet" href="/assets/css/main.css"><script>// Initialize theme
    // Must run before page rendering to prevent flash
    const themeConfig = document.documentElement.dataset;
    const theme = localStorage.getItem('theme');

    if (theme) {
      themeConfig.theme = theme;
    } else {
      const defaultTheme = themeConfig.defaultTheme;
      const useSystemTheme = themeConfig.useSystemTheme === 'true';
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

      themeConfig.theme = (useSystemTheme && prefersDark) ? 'dark' : defaultTheme;
    }</script><script defer="defer" src="/assets/js/main.bundle.js"></script></head><body><div class="wrapper-bg-wrapper"><div class="wrapper-bg"></div></div><header class="site-header"><div class="site-header__container"><span class="site-header__logo-container"><a class="site-header__logo" href="/" aria-label="Logo"> <?xml version="1.0" encoding="iso-8859-1"?> <!doctype html> <svg fill="#000000" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="800px" height="800px" viewBox="0 0 495.398 495.398" xml:space="preserve"><g><g><g><path d="M487.083,225.514l-75.08-75.08V63.704c0-15.682-12.708-28.391-28.413-28.391c-15.669,0-28.377,12.709-28.377,28.391
				v29.941L299.31,37.74c-27.639-27.624-75.694-27.575-103.27,0.05L8.312,225.514c-11.082,11.104-11.082,29.071,0,40.158
				c11.087,11.101,29.089,11.101,40.172,0l187.71-187.729c6.115-6.083,16.893-6.083,22.976-0.018l187.742,187.747
				c5.567,5.551,12.825,8.312,20.081,8.312c7.271,0,14.541-2.764,20.091-8.312C498.17,254.586,498.17,236.619,487.083,225.514z"/><path d="M257.561,131.836c-5.454-5.451-14.285-5.451-19.723,0L72.712,296.913c-2.607,2.606-4.085,6.164-4.085,9.877v120.401
				c0,28.253,22.908,51.16,51.16,51.16h81.754v-126.61h92.299v126.61h81.755c28.251,0,51.159-22.907,51.159-51.159V306.79
				c0-3.713-1.465-7.271-4.085-9.877L257.561,131.836z"/></g></g></g></svg> </a></span><button class="site-header__mobile-nav" data-drawer-trigger="" aria-controls="drawer-name" aria-expanded="false"><span class="site-header__mobile-nav-label">Menu</span> <svg width="226" height="187" viewBox="0 0 226 187" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M0 0H225.311V22.8494H0V0Z" fill="currentColor"/><path d="M0 81.872H225.311V104.721H0V81.872Z" fill="currentColor"/><path d="M0 163.744H225.311V186.593H0V163.744Z" fill="currentColor"/></svg></button><nav class="site-header__nav"><ul class="site-header__items"><li class="site-header__item"><a class="site-header__link" href="/about/">About</a></li><li class="site-header__item"><a class="site-header__link" href="/blog/">Blog</a></li><li class="site-header__item"><a class="site-header__link" href="/projects/">Projects</a></li><li class="site-header__item"><button class="site-header__link site-header__link--theme-switch" data-theme-switch><svg width="19" height="19" viewBox="0 0 19 19" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 14C7.01472 14 5 11.9853 5 9.5C5 7.01472 7.01472 5 9.5 5C11.9853 5 14 7.01472 14 9.5C14 11.9853 11.9853 14 9.5 14ZM9.5 13C11.433 13 13 11.433 13 9.5C13 7.567 11.433 6 9.5 6C7.567 6 6 7.567 6 9.5C6 11.433 7.567 13 9.5 13ZM10 3H9V0H10V3ZM14.4497 5.25736L13.7426 4.55025L15.864 2.42893L16.5711 3.13604L14.4497 5.25736ZM16 10V9H19V10H16ZM13.7426 14.4497L14.4497 13.7426L16.5711 15.864L15.864 16.5711L13.7426 14.4497ZM9 16H10V19H9V16ZM4.55025 13.7426L5.25736 14.4497L3.13604 16.5711L2.42893 15.864L4.55025 13.7426ZM3 9V10H0V9H3ZM5.25736 4.55025L4.55025 5.25736L2.42893 3.13604L3.13604 2.42893L5.25736 4.55025Z" fill="currentColor"/></svg></button></li></ul></nav></div></header><section class="drawer" id="drawer-name" data-drawer-target><div class="drawer__overlay" data-drawer-close tabindex="-1"></div><div class="drawer__wrapper"><div class="drawer__header"><button class="drawer__close" data-drawer-close aria-label="Close Drawer"><svg width="45" height="45" viewBox="0 0 45 45" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M0 3.84294L3.84294 0L22.4996 18.7131L41.2127 0L45 3.84294L26.3425 22.4996L45 41.2127L41.2127 45L22.4996 26.3425L3.84294 45L0 41.2127L18.7131 22.4996L0 3.84294Z" fill="currentColor"/></svg></button></div><div class="drawer__content"><ul class="drawer__nav"><li class="drawer__nav-item"><a href="/">Home</a></li><li class="drawer__nav-item"><a href="/about/">About</a></li><li class="drawer__nav-item"><a href="/blog/">Blog</a></li><li class="drawer__nav-item"><a href="/projects/">Projects</a></li></ul></div></div></section><main><div class="page-container"><article><h1>Getting Familiar with OrangeFS ‚Äì and Making (and Fixing) Mistakes</h1><p><time datetime="2025-07-15">15 July 2025</time></p><hr><p>So my next patch came from a suggestion by Shuah, my LFX mentor - a small but important cleanup in the FS subsystem.</p><h4 id="what-was-it%3F" tabindex="-1"><a class="header-anchor" href="#what-was-it%3F">#</a> What was it?</h4><p>This time, it was about replacing <code>scnprintf()</code> with <code>sysfs_emit()</code> in the FS sysfs code. Why? Well, because the kernel documentation clearly states in <code>Documentation/filesystems/sysfs.rst</code> that <code>show()</code> functions should only use <code>sysfs_emit()</code> or <code>sysfs_emit_at()</code> to ensure correct formatting of user-visible data. So yep, seemed simple enough - search, replace, test, send. I selected the <code>orangefs-sysfs.c</code> file.</p><p>The commit:</p><pre class="language-c"><code class="language-c">fs<span class="token operator">:</span> orangefs<span class="token operator">:</span> replace <span class="token function">scnprintf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> with <span class="token function">sysfs_emit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br>Documentation<span class="token operator">/</span>filesystems<span class="token operator">/</span>sysfs<span class="token punctuation">.</span>rst mentions that <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> should only<br>use <span class="token function">sysfs_emit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> or <span class="token function">sysfs_emit_at</span><span class="token punctuation">(</span><span class="token punctuation">)</span> when formating the value to be<br>returned to user space<span class="token punctuation">.</span> So replace <span class="token function">scnprintf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> with <span class="token function">sysfs_emit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><br><br>Signed<span class="token operator">-</span>off<span class="token operator">-</span>by<span class="token operator">:</span> Shankari Anand <span class="token operator">&lt;</span>shankari<span class="token punctuation">.</span>ak0208@gmail<span class="token punctuation">.</span>com<span class="token operator">></span><br>Signed<span class="token operator">-</span>off<span class="token operator">-</span>by<span class="token operator">:</span> Mike Marshall <span class="token operator">&lt;</span>hubcap@omnibond<span class="token punctuation">.</span>com<span class="token operator">></span></code></pre><p>There were a lot of places to update in the same file (<code>orangefs-sysfs.c</code>). I verified the patch twice, just to be sure.</p><p>...Except, I still managed to mess up one line ü§¶üèΩ‚Äç‚ôÄÔ∏è<br>A small copy-paste mistake slipped through in one of the replacements and I didn‚Äôt run <code>xfstests</code> either (because I didn‚Äôt know I should!).</p><hr><p>Example change in the Patch:</p><pre class="language-c"><code class="language-c"><br>diff <span class="token operator">--</span>git a<span class="token operator">/</span>fs<span class="token operator">/</span>orangefs<span class="token operator">/</span>orangefs<span class="token operator">-</span>sysfs<span class="token punctuation">.</span>c b<span class="token operator">/</span>fs<span class="token operator">/</span>orangefs<span class="token operator">/</span>orangefs<span class="token operator">-</span>sysfs<span class="token punctuation">.</span>c<br>index <span class="token number">04e15</span>dfa504aaf<span class="token punctuation">.</span><span class="token number">.369455</span>b354efa0 <span class="token number">100644</span><br><span class="token operator">--</span><span class="token operator">-</span> a<span class="token operator">/</span>fs<span class="token operator">/</span>orangefs<span class="token operator">/</span>orangefs<span class="token operator">-</span>sysfs<span class="token punctuation">.</span>c<br><span class="token operator">++</span><span class="token operator">+</span> b<span class="token operator">/</span>fs<span class="token operator">/</span>orangefs<span class="token operator">/</span>orangefs<span class="token operator">-</span>sysfs<span class="token punctuation">.</span>c<br>@@ <span class="token operator">-</span><span class="token number">217</span><span class="token punctuation">,</span><span class="token number">36</span> <span class="token operator">+</span><span class="token number">217</span><span class="token punctuation">,</span><span class="token number">31</span> @@ <span class="token keyword">static</span> <span class="token class-name">ssize_t</span> <span class="token function">sysfs_int_show</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">kobject</span> <span class="token operator">*</span>kobj<span class="token punctuation">,</span><br> <br> 	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strcmp</span><span class="token punctuation">(</span>kobj<span class="token operator">-></span>name<span class="token punctuation">,</span> ORANGEFS_KOBJ_ID<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br> 		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strcmp</span><span class="token punctuation">(</span>attr<span class="token operator">-></span>attr<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token string">"op_timeout_secs"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br><span class="token operator">-</span>			rc <span class="token operator">=</span> <span class="token function">scnprintf</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><br><span class="token operator">-</span>				       PAGE_SIZE<span class="token punctuation">,</span><br><span class="token operator">+</span>			rc <span class="token operator">=</span> <span class="token function">sysfs_emit</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><br> 				       <span class="token string">"%d\n"</span><span class="token punctuation">,</span><br> 				       op_timeout_secs<span class="token punctuation">)</span><span class="token punctuation">;</span><br> 			<span class="token keyword">goto</span> out<span class="token punctuation">;</span></code></pre><hr><h4 id="the-fix-(and-the-lesson)" tabindex="-1"><a class="header-anchor" href="#the-fix-(and-the-lesson)">#</a> The Fix (and the Lesson)</h4><p>Luckily, Mike (the maintainer) was super chill about it. He replied saying there's a small mistake but the patch itself is fine, and he even went ahead, fixed it, tested it with <code>xfstests</code>. Kindness in open source truly exists üòå.</p><p>So, in the next version, I fixed the mistake, ran the xfstests myself (now that I know about them), and sent the revised patch. And on July 15, it got accepted and applied üéâ</p><hr><h4 id="what-i-took-away" tabindex="-1"><a class="header-anchor" href="#what-i-took-away">#</a> What I Took Away</h4><p>This one taught me one big thing:</p><ul><li>Testing with the right suite (like xfstests for filesystems) is part of doing things right.</li></ul><p>I now see 3 patches with my name and while they‚Äôre small, each came with a learning curve. I'm still waiting for my Rust patch series to be reviewed, but this one gave me a good confidence boost.</p><ul><li><a href="https://git.kernel.org/pub/scm/linux/kernel/git/next/linux-next.git/commit/?id=d03e0b97244d89abaf38aa776300a60df3222e7a">The Commit upstream</a></li></ul><p class="tag-list"><a class="tag" href="/tags/lfx/" rel="tag">lfx</a> <a class="tag" href="/tags/linux-kernel/" rel="tag">linux-kernel</a> <a class="tag" href="/tags/fs/" rel="tag">fs</a></p></article><nav><a href="/blog/">‚Üê View All Articles</a></nav></div></main><footer class="site-footer"><small><a href="https://github.com/Shankari02" target="_blank" aria-label="GitHub"><img src="/assets/img/github.svg" alt="GitHub"> </a><a href="https://linkedin.com/in/shankari-anand" target="_blank" aria-label="LinkedIn"><img src="/assets/img/linkedin.svg" alt="LinkedIn"> </a><a href="mailto:shankari.anand618@gmail.com" target="_blank" aria-label="Twitter"><img src="/assets/img/mail.svg" alt="Email"></a></small></footer><script data-goatcounter="https://letscount.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script></body></html>