<!doctype html><html data-enable-theme-switch="true" data-use-system-theme="false" data-default-theme="light" data-current="post" lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Long series of patches and still waiting...</title><meta name="description" content="Get to know me through my personal blogs!"><link rel="dns-prefetch" href="https://identity.netlify.com"><script async src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="stylesheet" href="/assets/css/main.css"><script>// Initialize theme
    // Must run before page rendering to prevent flash
    const themeConfig = document.documentElement.dataset;
    const theme = localStorage.getItem('theme');

    if (theme) {
      themeConfig.theme = theme;
    } else {
      const defaultTheme = themeConfig.defaultTheme;
      const useSystemTheme = themeConfig.useSystemTheme === 'true';
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

      themeConfig.theme = (useSystemTheme && prefersDark) ? 'dark' : defaultTheme;
    }</script><script defer="defer" src="/assets/js/main.bundle.js"></script></head><body><div class="wrapper-bg-wrapper"><div class="wrapper-bg"></div></div><header class="site-header"><div class="site-header__container"><span class="site-header__logo-container"><a class="site-header__logo" href="/" aria-label="Logo"> <?xml version="1.0" encoding="iso-8859-1"?> <!doctype html> <svg fill="#000000" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="800px" height="800px" viewBox="0 0 495.398 495.398" xml:space="preserve"><g><g><g><path d="M487.083,225.514l-75.08-75.08V63.704c0-15.682-12.708-28.391-28.413-28.391c-15.669,0-28.377,12.709-28.377,28.391
				v29.941L299.31,37.74c-27.639-27.624-75.694-27.575-103.27,0.05L8.312,225.514c-11.082,11.104-11.082,29.071,0,40.158
				c11.087,11.101,29.089,11.101,40.172,0l187.71-187.729c6.115-6.083,16.893-6.083,22.976-0.018l187.742,187.747
				c5.567,5.551,12.825,8.312,20.081,8.312c7.271,0,14.541-2.764,20.091-8.312C498.17,254.586,498.17,236.619,487.083,225.514z"/><path d="M257.561,131.836c-5.454-5.451-14.285-5.451-19.723,0L72.712,296.913c-2.607,2.606-4.085,6.164-4.085,9.877v120.401
				c0,28.253,22.908,51.16,51.16,51.16h81.754v-126.61h92.299v126.61h81.755c28.251,0,51.159-22.907,51.159-51.159V306.79
				c0-3.713-1.465-7.271-4.085-9.877L257.561,131.836z"/></g></g></g></svg> </a></span><button class="site-header__mobile-nav" data-drawer-trigger="" aria-controls="drawer-name" aria-expanded="false"><span class="site-header__mobile-nav-label">Menu</span> <svg width="226" height="187" viewBox="0 0 226 187" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M0 0H225.311V22.8494H0V0Z" fill="currentColor"/><path d="M0 81.872H225.311V104.721H0V81.872Z" fill="currentColor"/><path d="M0 163.744H225.311V186.593H0V163.744Z" fill="currentColor"/></svg></button><nav class="site-header__nav"><ul class="site-header__items"><li class="site-header__item"><a class="site-header__link" href="/about/">About</a></li><li class="site-header__item"><a class="site-header__link" href="/blog/">Blog</a></li><li class="site-header__item"><a class="site-header__link" href="/projects/">Projects</a></li><li class="site-header__item"><button class="site-header__link site-header__link--theme-switch" data-theme-switch><svg width="19" height="19" viewBox="0 0 19 19" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 14C7.01472 14 5 11.9853 5 9.5C5 7.01472 7.01472 5 9.5 5C11.9853 5 14 7.01472 14 9.5C14 11.9853 11.9853 14 9.5 14ZM9.5 13C11.433 13 13 11.433 13 9.5C13 7.567 11.433 6 9.5 6C7.567 6 6 7.567 6 9.5C6 11.433 7.567 13 9.5 13ZM10 3H9V0H10V3ZM14.4497 5.25736L13.7426 4.55025L15.864 2.42893L16.5711 3.13604L14.4497 5.25736ZM16 10V9H19V10H16ZM13.7426 14.4497L14.4497 13.7426L16.5711 15.864L15.864 16.5711L13.7426 14.4497ZM9 16H10V19H9V16ZM4.55025 13.7426L5.25736 14.4497L3.13604 16.5711L2.42893 15.864L4.55025 13.7426ZM3 9V10H0V9H3ZM5.25736 4.55025L4.55025 5.25736L2.42893 3.13604L3.13604 2.42893L5.25736 4.55025Z" fill="currentColor"/></svg></button></li></ul></nav></div></header><section class="drawer" id="drawer-name" data-drawer-target><div class="drawer__overlay" data-drawer-close tabindex="-1"></div><div class="drawer__wrapper"><div class="drawer__header"><button class="drawer__close" data-drawer-close aria-label="Close Drawer"><svg width="45" height="45" viewBox="0 0 45 45" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M0 3.84294L3.84294 0L22.4996 18.7131L41.2127 0L45 3.84294L26.3425 22.4996L45 41.2127L41.2127 45L22.4996 26.3425L3.84294 45L0 41.2127L18.7131 22.4996L0 3.84294Z" fill="currentColor"/></svg></button></div><div class="drawer__content"><ul class="drawer__nav"><li class="drawer__nav-item"><a href="/">Home</a></li><li class="drawer__nav-item"><a href="/about/">About</a></li><li class="drawer__nav-item"><a href="/blog/">Blog</a></li><li class="drawer__nav-item"><a href="/projects/">Projects</a></li></ul></div></div></section><main><div class="page-container"><article><h1>Long series of patches and still waiting...</h1><p><time datetime="2025-07-17">17 July 2025</time></p><hr><p>So this patch series began when I looked at this <a href="https://github.com/Rust-for-Linux/linux/issues/1173">issue</a> in the Rust for Linux project. It looked pretty simple on the surface.</p><blockquote><p>‚ÄúJust move these parts (ARef and AlwaysRefCounted) into a new file, clean it up, done.‚Äù</p></blockquote><p>At least that‚Äôs what I thought‚Ä¶</p><hr><h4 id="the-rabbit-hole" tabindex="-1"><a class="header-anchor" href="#the-rabbit-hole">#</a> The Rabbit Hole</h4><p>The moment I ran <code>make LLVM=1</code>, I realized:<br>There were references to <code>ARef</code> and <code>AlwaysRefCounted</code> all over the place. So this wasn't just about moving code; it involved updating all the call sites too.</p><p>I started wondering - should I really send this as one massive patch? It didn‚Äôt seem ideal. So I dropped a comment on the issue asking whether I should split the moving and refactoring. The maintainers replied with a clear <em>yes</em>.</p><hr><h4 id="learning-about-git---base" tabindex="-1"><a class="header-anchor" href="#learning-about-git---base">#</a> Learning About git --base</h4><p>So I sent the first patch, just the moving one. And that's when someone pointed out:</p><blockquote><p>&quot;Add --base to your git format-patch command.&quot;</p></blockquote><p>That was a neat trick I hadn‚Äôt used before. It helps indicate the base commit over which your patch is applied, so reviewers don‚Äôt face weird diffs or merge conflicts. Been using it ever since for every patch.</p><hr><h4 id="iterations-begin..." tabindex="-1"><a class="header-anchor" href="#iterations-begin...">#</a> Iterations Begin...</h4><p>In v2, I sent both patches - the moving one and the call-site updates.</p><p>Except... I messed up. Again.</p><p>Some extra lines sneaked into the new file. No clue how it happens every time with meü•∫ but hey, we learn from it. So I fixed it and sent v3.</p><p>That‚Äôs when maintainers pointed out something important:<br>The call-site updates should be split subsystem-wise, so each maintainer can review their relevant part and potentially give Acked-by.<br>They were kind enough to even give me an example to follow (you‚Äôll see it in the Email thread if you're curious).</p><hr><h4 id="interactive-rebase-is-magic-%F0%9F%9A%80" tabindex="-1"><a class="header-anchor" href="#interactive-rebase-is-magic-%F0%9F%9A%80">#</a> Interactive Rebase Is Magic üöÄ</h4><p>Once I figured that out, I started digging through the tree to identify which subsystem each call-site belonged to and broke it down into separate patches.</p><p>That‚Äôs when I truly appreciated how powerful <code>git rebase -i</code> is. Being able to split, edit, squash, and reorder patches made everything feel more manageable. It went from one giant wall of change to a clean, modular patch series.</p><hr><h4 id="confusion-(and-a-bit-of-a-gamble)" tabindex="-1"><a class="header-anchor" href="#confusion-(and-a-bit-of-a-gamble)">#</a> Confusion (and a Bit of a Gamble)</h4><p>I hit a bit of a gray area when it came to the core kernel files.<br>Some of them had different maintainers here and there. I wasn‚Äôt sure if I should split these out too, but honestly, the series was already long enough and splitting these would take it higher by an additional 10.</p><p>If they ask me to separate them later, I‚Äôll do it. But for now, I decided to leave them grouped.</p><hr><h4 id="still-waiting..." tabindex="-1"><a class="header-anchor" href="#still-waiting...">#</a> Still Waiting...</h4><p>So yeah, that‚Äôs the story of this patch series. Definitely the most involved one I‚Äôve done yet.</p><p>The <a href="https://lore.kernel.org/rust-for-linux/DBCLH4WXYTJL.FDZ9B39OO3TY@kernel.org/T/#mb67fbddcd894665d6ec6b0854e37930dedab468b">first patch (the move)</a> has already been accepted, which gave me a bit of peace of mind üòå</p><p>Now I‚Äôm just waiting on Acked-bys for the rest. Fingers crossed ü§û<br>Hopefully they‚Äôll all be upstreamed soon!</p><hr><p>The series:<br><a href="https://lore.kernel.org/rust-for-linux/CANiq72k1ENBFw7eNc5Kb5cFagysqfsHt9a=Tr4NxuVcV2TD=nQ@mail.gmail.com/T/#mc3f4d39ca2d92ef4343fb60dd09450c3502d83c0">1/7</a>, <a href="https://lore.kernel.org/rust-for-linux/20250716090941.811418-1-shankari.ak0208@gmail.com/T/#u">2/7</a>, <a href="https://lore.kernel.org/rust-for-linux/20250716091158.812860-1-shankari.ak0208@gmail.com/T/#u">3/7</a>, <a href="https://lore.kernel.org/rust-for-linux/20250716091827.816971-1-shankari.ak0208@gmail.com/T/#u">4/7</a>, <a href="https://lore.kernel.org/rust-for-linux/20250717072724.14602-1-shankari.ak0208@gmail.com/T/#u">5/7</a>, <a href="https://lore.kernel.org/rust-for-linux/20250717073108.14943-1-shankari.ak0208@gmail.com/T/#u">6/7</a>, <a href="https://lore.kernel.org/rust-for-linux/20250717073450.15090-1-shankari.ak0208@gmail.com/T/#u">7/7</a></p><p>(PS: I might have referenced this blog in few others just beacuse its been going on for quite a while now, but yes, there has been a lot of learning through this and the maintainers have been really good throughout)</p><p class="tag-list"><a class="tag" href="/tags/lfx/" rel="tag">lfx</a> <a class="tag" href="/tags/rust-for-linux/" rel="tag">rust-for-linux</a> <a class="tag" href="/tags/sync/" rel="tag">sync</a></p></article><nav><a href="/blog/">‚Üê View All Articles</a></nav></div></main><footer class="site-footer"><small><a href="https://github.com/Shankari02" target="_blank" aria-label="GitHub"><img src="/assets/img/github.svg" alt="GitHub"> </a><a href="https://linkedin.com/in/shankari-anand" target="_blank" aria-label="LinkedIn"><img src="/assets/img/linkedin.svg" alt="LinkedIn"> </a><a href="mailto:shankari.anand618@gmail.com" target="_blank" aria-label="Twitter"><img src="/assets/img/mail.svg" alt="Email"></a></small></footer></body></html>