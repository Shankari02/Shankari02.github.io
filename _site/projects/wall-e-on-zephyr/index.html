<!doctype html><html data-enable-theme-switch="true" data-use-system-theme="false" data-default-theme="light" data-current="project" lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Wall-E on Zephyr</title><meta name="description" content="Exploring Zephyr RTOS"><link rel="dns-prefetch" href="https://identity.netlify.com"><script async src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="stylesheet" href="/assets/css/main.css"><script>// Initialize theme
    // Must run before page rendering to prevent flash
    const themeConfig = document.documentElement.dataset;
    const theme = localStorage.getItem('theme');

    if (theme) {
      themeConfig.theme = theme;
    } else {
      const defaultTheme = themeConfig.defaultTheme;
      const useSystemTheme = themeConfig.useSystemTheme === 'true';
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

      themeConfig.theme = (useSystemTheme && prefersDark) ? 'dark' : defaultTheme;
    }</script><script defer="defer" src="/assets/js/main.bundle.js"></script></head><body><div class="wrapper-bg-wrapper"><div class="wrapper-bg"></div></div><header class="site-header"><div class="site-header__container"><span class="site-header__logo-container"><a class="site-header__logo" href="/" aria-label="Logo"> <?xml version="1.0" encoding="iso-8859-1"?> <!doctype html> <svg fill="#000000" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="800px" height="800px" viewBox="0 0 495.398 495.398" xml:space="preserve"><g><g><g><path d="M487.083,225.514l-75.08-75.08V63.704c0-15.682-12.708-28.391-28.413-28.391c-15.669,0-28.377,12.709-28.377,28.391
				v29.941L299.31,37.74c-27.639-27.624-75.694-27.575-103.27,0.05L8.312,225.514c-11.082,11.104-11.082,29.071,0,40.158
				c11.087,11.101,29.089,11.101,40.172,0l187.71-187.729c6.115-6.083,16.893-6.083,22.976-0.018l187.742,187.747
				c5.567,5.551,12.825,8.312,20.081,8.312c7.271,0,14.541-2.764,20.091-8.312C498.17,254.586,498.17,236.619,487.083,225.514z"/><path d="M257.561,131.836c-5.454-5.451-14.285-5.451-19.723,0L72.712,296.913c-2.607,2.606-4.085,6.164-4.085,9.877v120.401
				c0,28.253,22.908,51.16,51.16,51.16h81.754v-126.61h92.299v126.61h81.755c28.251,0,51.159-22.907,51.159-51.159V306.79
				c0-3.713-1.465-7.271-4.085-9.877L257.561,131.836z"/></g></g></g></svg> </a></span><button class="site-header__mobile-nav" data-drawer-trigger="" aria-controls="drawer-name" aria-expanded="false"><span class="site-header__mobile-nav-label">Menu</span> <svg width="226" height="187" viewBox="0 0 226 187" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M0 0H225.311V22.8494H0V0Z" fill="currentColor"/><path d="M0 81.872H225.311V104.721H0V81.872Z" fill="currentColor"/><path d="M0 163.744H225.311V186.593H0V163.744Z" fill="currentColor"/></svg></button><nav class="site-header__nav"><ul class="site-header__items"><li class="site-header__item"><a class="site-header__link" href="/about/">About</a></li><li class="site-header__item"><a class="site-header__link" href="/blog/">Blog</a></li><li class="site-header__item"><a class="site-header__link" href="/projects/">Projects</a></li><li class="site-header__item"><button class="site-header__link site-header__link--theme-switch" data-theme-switch><svg width="19" height="19" viewBox="0 0 19 19" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 14C7.01472 14 5 11.9853 5 9.5C5 7.01472 7.01472 5 9.5 5C11.9853 5 14 7.01472 14 9.5C14 11.9853 11.9853 14 9.5 14ZM9.5 13C11.433 13 13 11.433 13 9.5C13 7.567 11.433 6 9.5 6C7.567 6 6 7.567 6 9.5C6 11.433 7.567 13 9.5 13ZM10 3H9V0H10V3ZM14.4497 5.25736L13.7426 4.55025L15.864 2.42893L16.5711 3.13604L14.4497 5.25736ZM16 10V9H19V10H16ZM13.7426 14.4497L14.4497 13.7426L16.5711 15.864L15.864 16.5711L13.7426 14.4497ZM9 16H10V19H9V16ZM4.55025 13.7426L5.25736 14.4497L3.13604 16.5711L2.42893 15.864L4.55025 13.7426ZM3 9V10H0V9H3ZM5.25736 4.55025L4.55025 5.25736L2.42893 3.13604L3.13604 2.42893L5.25736 4.55025Z" fill="currentColor"/></svg></button></li></ul></nav></div></header><section class="drawer" id="drawer-name" data-drawer-target><div class="drawer__overlay" data-drawer-close tabindex="-1"></div><div class="drawer__wrapper"><div class="drawer__header"><button class="drawer__close" data-drawer-close aria-label="Close Drawer"><svg width="45" height="45" viewBox="0 0 45 45" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M0 3.84294L3.84294 0L22.4996 18.7131L41.2127 0L45 3.84294L26.3425 22.4996L45 41.2127L41.2127 45L22.4996 26.3425L3.84294 45L0 41.2127L18.7131 22.4996L0 3.84294Z" fill="currentColor"/></svg></button></div><div class="drawer__content"><ul class="drawer__nav"><li class="drawer__nav-item"><a href="/">Home</a></li><li class="drawer__nav-item"><a href="/about/">About</a></li><li class="drawer__nav-item"><a href="/blog/">Blog</a></li><li class="drawer__nav-item"><a href="/projects/">Projects</a></li></ul></div></div></section><main><div class="page-container"><h1><span class="project-card__emoji">🚜</span> Wall-E on Zephyr</h1><hr><p>I worked on a robot <strong>Wall-E</strong> - a self-balancing, line-following bot. The earlier version was built using <strong>ESP32</strong> and <strong>FreeRTOS</strong>, and you can find that on <a href="https://github.com/SRA-VJTI/Wall-E">GitHub</a>.</p><p>But for this project, I wanted to take it a step further and try out <strong>Zephyr RTOS</strong> on the <strong>Beagleconnect Freedom</strong> board. It wasn’t just a port, a deep dive into <strong>PWM APIs, ADCs, UARTs</strong>, and the (in)famous <strong>Devicetree overlays</strong> in Zephyr.</p><hr><h4 id="what-it-does" tabindex="-1"><a class="header-anchor" href="#what-it-does">#</a> What it does</h4><ul><li>Uses <strong>TB6612FNG</strong> to control the DC motors via <strong>PWM</strong>.</li><li>Reads sensor output via <strong>ADC</strong> and sends that over <strong>UART</strong> for debugging.</li><li>Tracks lines accurately, thanks to good signal filtering and fast PWM switching.</li></ul><hr><h4 id="why-zephyr%3F" tabindex="-1"><a class="header-anchor" href="#why-zephyr%3F">#</a> Why Zephyr?</h4><p>I have already played with FreeRTOS, but Zephyr caught my eye for a few reasons:</p><ul><li>It's actively maintained and modular.</li><li>Supports Devicetree (just like Linux).</li><li>Industry adoption is growing.</li><li>Great abstraction for drivers (ADC, PWM, UART, etc).</li></ul><p>That said, <strong>Devicetree overlays</strong> were… a journey 😅</p><hr><h2 id="devicetree-overlays" tabindex="-1"><a class="header-anchor" href="#devicetree-overlays">#</a> Devicetree Overlays</h2><p>Here's an example overlay I wrote to enable <code>pwm0</code>:</p><pre class="language-c"><code class="language-c"><span class="token operator">&amp;</span>pwm0 <span class="token punctuation">{</span><br>    status <span class="token operator">=</span> <span class="token string">"okay"</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token operator">&amp;</span>pwmleds <span class="token punctuation">{</span><br>    compatible <span class="token operator">=</span> <span class="token string">"pwm-leds"</span><span class="token punctuation">;</span><br>    led1<span class="token operator">:</span> pwm_led_1 <span class="token punctuation">{</span><br>        pwms <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator">&amp;</span>pwm0 <span class="token number">0</span> <span class="token function">PWM_MSEC</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> PWM_POLARITY_NORMAL<span class="token operator">></span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>And I could get motors running -</p><div style="text-align: center;"><video width="200" height="300" controls><source src="/assets/img/blog_images/wall-e-zephyr/motors-running.mp4" type="video/mp4"></video></div><p>And for ADC:</p><pre class="language-c"><code class="language-c"><span class="token operator">&amp;</span>adc <span class="token punctuation">{</span><br>    status <span class="token operator">=</span> <span class="token string">"okay"</span><span class="token punctuation">;</span><br>    channel@<span class="token number">0</span> <span class="token punctuation">{</span><br>        reg <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">></span><span class="token punctuation">;</span><br>        zephyr<span class="token punctuation">,</span>channel<span class="token operator">-</span>id <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">></span><span class="token punctuation">;</span><br>        zephyr<span class="token punctuation">,</span>gain <span class="token operator">=</span> <span class="token string">"ADC_GAIN_1"</span><span class="token punctuation">;</span><br>        zephyr<span class="token punctuation">,</span>reference <span class="token operator">=</span> <span class="token string">"ADC_REF_INTERNAL"</span><span class="token punctuation">;</span><br>        zephyr<span class="token punctuation">,</span>acquisition<span class="token operator">-</span>time <span class="token operator">=</span> <span class="token operator">&lt;</span>ADC_ACQ_TIME_DEFAULT<span class="token operator">></span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>We also got to enable drivers in prj.conf:</p><pre class="language-c"><code class="language-c">CONFIG_PWM<span class="token operator">=</span>y<br>CONFIG_ADC<span class="token operator">=</span>y<br>CONFIG_UART_CONSOLE<span class="token operator">=</span>y</code></pre><hr><h4 id="challenges-i-faced" tabindex="-1"><a class="header-anchor" href="#challenges-i-faced">#</a> Challenges I Faced</h4><p>Devicetree overlays took a while to understand, especially how to structure them and which nodes to patch.</p><ul><li>PWM driver wasn’t obvious at first. Some pins didn't support it and silently failed.</li><li>ADC values fluctuated like crazy until I used internal reference and correct gain settings.</li><li>UART wasn’t logging until I enabled it explicitly in the board overlay and Kconfig.</li></ul><hr><h4 id="resources" tabindex="-1"><a class="header-anchor" href="#resources">#</a> Resources</h4><ul><li><a href="https://docs.zephyrproject.org/latest/build/dts/index.html">Zephyr Devicetree Guide</a></li><li><a href="https://docs.zephyrproject.org/latest/doxygen/html/group__pwm__interface.html">Zephyr PWM API</a></li><li><a href="https://docs.zephyrproject.org/latest/doxygen/html/group__adc__interface.html">Zephyr ADC API</a></li><li><a href="https://docs.beagleboard.org/boards/beagleconnect/freedom/index.html#beagleconnect-freedom-home">BeagleConnect Freedom Docs</a></li><li><a href="https://github.com/Shankari02/Wall-E_Zephyr_Port/tree/main">Github Repository</a></li></ul><nav><a href="/projects/">← View All Projects</a></nav></div></main><footer class="site-footer"><small><a href="https://github.com/Shankari02" target="_blank" aria-label="GitHub"><img src="/assets/img/github.svg" alt="GitHub"> </a><a href="https://linkedin.com/in/shankari-anand" target="_blank" aria-label="LinkedIn"><img src="/assets/img/linkedin.svg" alt="LinkedIn"> </a><a href="mailto:shankari.anand618@gmail.com" target="_blank" aria-label="Twitter"><img src="/assets/img/mail.svg" alt="Email"></a></small></footer></body></html>